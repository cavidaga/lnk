<!DOCTYPE html>
<html lang="az" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Şifrəni sıfırla — LNK.az</title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    .auth-container { max-width: 420px; margin: 2rem auto; padding: 2rem; background: var(--card, #fff); border: 1px solid var(--border, #e5e7eb); border-radius: 12px; }
    .form-group { margin-bottom: 1rem; }
    label { display:block; margin-bottom: .5rem; font-weight: 500; }
    input { width: 100%; padding: .75rem; border: 1px solid #d1d5db; border-radius: 8px; }
    .btn { width: 100%; padding: .75rem; border: none; border-radius: 8px; background: #3b82f6; color: #fff; font-weight: 600; }
    .btn:disabled { opacity: .6; }
    .message { margin-top: 1rem; padding: .75rem; border-radius: 8px; display:none; }
    .error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
    .success { background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0; }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      const requestView = document.getElementById('request-view');
      const resetView = document.getElementById('reset-view');
      if (token) { requestView.style.display='none'; resetView.style.display='block'; }

      // Request form
      const reqForm = document.getElementById('request-form');
      reqForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('req-email').value.trim().toLowerCase();
        const msg = document.getElementById('req-msg'); msg.style.display='none';
        try {
          const r = await fetch('/api/auth/request-password-reset', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ email }) });
          if (r.ok) {
            msg.className='message success'; msg.textContent='Əgər e-poçt mövcuddursa, bərpa linki göndərildi.'; msg.style.display='block';
          } else { throw new Error('Xəta'); }
        } catch { msg.className='message error'; msg.textContent='Xəta baş verdi.'; msg.style.display='block'; }
      });

      // Reset form
      const resetForm = document.getElementById('reset-form');
      resetForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const newPassword = document.getElementById('new-pass').value;
        const msg = document.getElementById('reset-msg'); msg.style.display='none';
        try {
          const r = await fetch('/api/auth/reset-password', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ token, newPassword }) });
          const data = await r.json().catch(()=>({}));
          if (r.ok) {
            msg.className='message success'; msg.textContent='Şifrə yeniləndi. Giriş səhifəsinə yönləndirilirsiniz...'; msg.style.display='block';
            setTimeout(()=>{ window.location.href='/user-login.html'; }, 1200);
          } else {
            msg.className='message error'; msg.textContent= data.message || 'Token etibarsız və ya vaxtı bitib.'; msg.style.display='block';
          }
        } catch { msg.className='message error'; msg.textContent='Xəta baş verdi.'; msg.style.display='block'; }
      });
    });
  </script>
  </head>
  <body>
    <div class="wrap">
      <main id="main" role="main">
        <div class="auth-container">
          <div id="request-view" style="display:block">
            <h1>Şifrəni unutdum</h1>
            <p>E-poçtunuzu daxil edin. Əgər hesab mövcuddursa, bərpa linki göndəriləcək.</p>
            <form id="request-form">
              <div class="form-group"><label for="req-email">E-poçt</label><input id="req-email" type="email" required></div>
              <button class="btn" type="submit">Link göndər</button>
              <div id="req-msg" class="message"></div>
            </form>
          </div>
          <div id="reset-view" style="display:none">
            <h1>Şifrəni sıfırla</h1>
            <p>Yeni şifrəni daxil edin (ən azı 8 simvol).</p>
            <form id="reset-form">
              <div class="form-group"><label for="new-pass">Yeni şifrə</label><input id="new-pass" type="password" minlength="8" required></div>
              <button class="btn" type="submit">Şifrəni yenilə</button>
              <div id="reset-msg" class="message"></div>
            </form>
          </div>
        </div>
      </main>
    </div>
  </body>
  </html>

